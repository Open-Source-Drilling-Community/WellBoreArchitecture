# WellBoreArchitecture Model

The `Model` project contains the domain objects that describe a full wellbore architecture, including probabilistic drilling properties, structural elements, and helper enumerations. It targets `net8.0` and depends on the NORCE/OSDC drilling libraries for unit handling and statistical distributions.

## Structure
- `Model.csproj` – configures the library (nullable enabled, DocFX metadata, OSDC package references).
- Root classes – core domain types such as `WellBoreArchitecture`, `WellHead`, `SurfaceSection`, `CasingSection`, `OpenHoleSection`, `SideElement`, `SideConnector`, and supporting value objects (`BoreHoleSize`, `ElementConnectivity`).
- `*Realization.cs` – deterministic counterparts returned by calling `Realize()` on a stochastic type (e.g., `SurfaceSection` → `SurfaceSectionRealization`).
- `DerivedTypes/` – enumerations that constrain allowed values (`SurfaceSectionType`, `SideElementType`, `FluidType`).
- `docfx.json` – DocFX configuration used to generate API reference material from this project.

### Probabilistic to deterministic flow
Most engineering quantities are modeled as `GaussianDrillingProperty` or `ScalarDrillingProperty`. Each domain object implements a `Realize()` method that samples those distributions (currently by calling `Value.Realize()` from the OSDC packages) and returns the associated `*Realization` class with concrete doubles. This pattern lets consumers choose between storing full probabilistic descriptions and using single deterministic snapshots.

### Aggregation
`WellBoreArchitecture` is the aggregate root. It encapsulates metadata, wellhead information, above-ground fluids, surface sections, and casing sections. `WellBoreArchitecture.Calculate()` currently performs a minimal validation (ensuring at least one surface section) and can be extended with additional derived calculations.

## Relationship with other solution projects
- `Service/Service.csproj` references this project directly. Controllers and managers expose and persist the `Model` types in the REST API (see `Service/Controllers/WellBoreArchitectureController.cs`).
- `ModelTest/ModelTest.csproj` depends on the model to exercise unit tests for serialization, realizations, and guard clauses.
- `ModelSharedOut` produces a client-facing bundle (`WellBoreArchitectureMergedModel.cs`) from the OpenAPI schema generated by the service. While it does not reference this project directly, the service schema is defined by these types, so any changes here propagate through the generated client and the `WebApp`.
- `WebApp` consumes `ModelSharedOut` to interact with the service API using the shared contract generated from this model.

## Building and testing
```powershell
# Restore and build the model on its own
dotnet build Model/Model.csproj

# Run the accompanying unit tests
dotnet test ModelTest/ModelTest.csproj
```

## Generating documentation
DocFX metadata can be produced by running:
```powershell
docfx docfx.json
```
This generates API documentation under `Model/_site`. (DocFX must be installed separately.)

## Usage example
```csharp
using NORCE.Drilling.WellBoreArchitecture.Model;
using OSDC.DotnetLibraries.General.DrillingProperties;

var architecture = new WellBoreArchitecture
{
    Name = "Demo well",
    WellHead = new WellHead { DatumDepth = new GaussianDrillingProperty() },
};

architecture.SurfaceSections.Add(new SurfaceSection
{
    Type = SurfaceSectionType.MarineRiser,
    SectionLength = new GaussianDrillingProperty(),
});

// Validate and produce deterministic snapshot
if (architecture.Calculate())
{
    WellBoreArchitectureRealization snapshot = architecture.Realize();
    // snapshot.SurfaceSections now contains doubles instead of probabilistic properties
}
```

## When modifying the model
- Update or add unit tests in `ModelTest` so service builds remain stable.
- Consider the impact on the REST contract (`Service`) and regenerate the shared model (`ModelSharedOut`) if the API surface changes.
- Refresh DocFX output if you maintain published API documentation.
